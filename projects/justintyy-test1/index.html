<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>25:00 ‚Ä¢ Áï™ËåÑÈêò</title>
  <style>
    /* ---- CSS Variables & Reset ---- */
    :root {
      --bg-start: #0f1226; /* deep indigo */
      --bg-end: #0a0d18;   /* near-black */
      --text: #e6e6f0;
      --muted: #a7a9b8;
      --panel: #161a2e;
      --outline: rgba(255,255,255,0.08);
      --work: #ff8a3d;  /* warm orange */
      --break: #3db8ff; /* cool blue */
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius: 18px;
      --ring-track: rgba(255,255,255,0.08);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1200px 800px at 70% -10%, #1a2142 0%, transparent 60%),
                  radial-gradient(900px 700px at -10% 110%, #121a36 0%, transparent 60%),
                  linear-gradient(160deg, var(--bg-start), var(--bg-end));
      display: grid;
      place-items: center;
      padding: 20px;
    }

    /* ---- App Shell ---- */
    .app {
      width: min(640px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      padding: 18px 18px 22px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      width: 28px; height: 28px;
      border-radius: 999px;
      background: conic-gradient(from 0deg, var(--work), var(--break));
      box-shadow: 0 0 0 2px var(--outline) inset, 0 6px 18px rgba(0,0,0,0.3);
    }

    .title { font-weight: 700; letter-spacing: .3px; }
    .subtitle { color: var(--muted); font-size: 12px; }

    .mode-toggle {
      display: inline-flex;
      background: #0f1326;
      border: 1px solid var(--outline);
      border-radius: 12px;
      overflow: hidden;
    }

    .seg {
      padding: 8px 12px;
      font-size: 13px;
      color: var(--muted);
      cursor: pointer;
      border: none;
      background: transparent;
      transition: background .2s ease, color .2s ease;
    }
    .seg.active {
      color: var(--text);
      background: rgba(255,255,255,0.06);
    }

    /* ---- Timer Card ---- */
    .card {
      position: relative;
      border-radius: var(--radius);
      border: 1px solid var(--outline);
      padding: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      box-shadow: var(--shadow);
    }

    .ring-wrap {
      width: min(80vw, 360px);
      height: min(80vw, 360px);
      margin: 12px auto 18px;
      position: relative;
      display: grid;
      place-items: center;
    }
    svg { display: block; width: 100%; height: 100%; }

    .timer-text {
      position: absolute;
      display: grid; place-items: center;
      text-align: center;
    }
    .time {
      font-size: clamp(42px, 10vw, 64px);
      font-weight: 800;
      letter-spacing: 1px;
    }
    .mode-label { color: var(--muted); margin-top: 6px; font-size: 13px; }

    /* ---- Controls ---- */
    .controls {
      display: grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 10px;
      margin-top: 12px;
    }

    .btn {
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid var(--outline);
      background: #0e1226;
      color: var(--text);
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: transform .12s ease, box-shadow .12s ease, background .2s ease;
      box-shadow: 0 2px 0 rgba(255,255,255,0.06) inset;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }

    .btn.primary {
      background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid color-mix(in oklab, var(--outline), white 2%);
    }

    .badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--outline);
      font-size: 13px; color: var(--muted);
    }
    .badge strong { color: var(--text); }

    .footer {
      display: flex; align-items: center; justify-content: space-between;
      margin-top: 14px; flex-wrap: wrap; gap: 10px;
    }

    /* ---- Dialog ---- */
    dialog {
      width: min(560px, 92vw);
      border: 1px solid var(--outline);
      border-radius: 16px;
      padding: 0;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      color: var(--text);
      box-shadow: var(--shadow);
    }
    dialog::backdrop { background: rgba(0,0,0,0.55); backdrop-filter: blur(2px); }
    .d-head { padding: 16px 18px; border-bottom: 1px solid var(--outline); font-weight: 700; }
    .d-body { padding: 16px 18px; display: grid; gap: 14px; }
    .row { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; }
    label { color: var(--muted); font-size: 14px; }
    input[type="number"] {
      width: 110px; padding: 10px 12px; border-radius: 12px;
      border: 1px solid var(--outline); background: #0d1124; color: var(--text);
    }
    .d-foot { padding: 14px 18px; border-top: 1px solid var(--outline); display: flex; justify-content: flex-end; gap: 10px; }

    /* ---- Responsive ---- */
    @media (min-width: 680px) {
      .controls { grid-template-columns: repeat(4, max-content); justify-content: center; }
      .btn { padding: 12px 18px; }
    }
  </style>
</head>
<body>
  <main class="app" id="app">
    <header class="header">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">Áï™ËåÑÈêò</div>
          <div class="subtitle">Mobile‚Äëfirst ‚Ä¢ Ê∑±Ëâ≤Ê®°Âºè</div>
        </div>
      </div>
      <div class="mode-toggle" role="tablist" aria-label="Â∑•‰Ωú/‰ºëÊÅØÊ®°ÂºèÂàáÊèõ">
        <button class="seg active" id="workTab" role="tab" aria-selected="true">Â∑•‰Ωú</button>
        <button class="seg" id="breakTab" role="tab" aria-selected="false">‰ºëÊÅØ</button>
      </div>
    </header>

    <section class="card" aria-label="Ë®àÊôÇÂô®">
      <div class="ring-wrap">
        <svg viewBox="0 0 120 120" aria-hidden="true">
          <!-- track -->
          <circle cx="60" cy="60" r="54" stroke="var(--ring-track)" stroke-width="8" fill="none" />
          <!-- progress ring -->
          <circle id="ring" cx="60" cy="60" r="54" stroke="var(--work)" stroke-linecap="round" stroke-width="8" fill="none"
                  style="transform: rotate(-90deg); transform-origin: 50% 50%; stroke-dasharray: 339.292; stroke-dashoffset: 0;" />
        </svg>
        <div class="timer-text">
          <div class="time" id="time">25:00</div>
          <div class="mode-label" id="modeLabel">Â∑•‰Ωú‰∏≠</div>
        </div>
      </div>

      <div class="controls">
        <button class="btn primary" id="startPauseBtn" aria-pressed="false">ÈñãÂßã</button>
        <button class="btn" id="resetBtn">ÈáçÁΩÆ</button>
        <button class="btn" id="toggleBtn">ÂàáÊèõÊ®°Âºè</button>
        <button class="btn" id="settingsBtn">Ë®≠ÂÆö</button>
      </div>

      <div class="footer">
        <div class="badge" title="ÂÆåÊàêÁöÑÁï™ËåÑÊï∏">
          üçÖ Â∑≤ÂÆåÊàêÔºö<strong id="pomodoroCount">0</strong>
        </div>
        <div class="badge" id="statusBadge">Â∞±Á∑í</div>
      </div>
    </section>
  </main>

  <!-- Settings Dialog -->
  <dialog id="settingsDialog" aria-labelledby="settingsTitle">
    <div class="d-head" id="settingsTitle">Ë®≠ÂÆö</div>
    <form method="dialog">
      <div class="d-body">
        <div class="row">
          <label for="workInput">Â∑•‰ΩúÊôÇÈñìÔºàÂàÜÈêòÔºâ</label>
          <input id="workInput" type="number" min="1" max="180" step="1" />
        </div>
        <div class="row">
          <label for="breakInput">‰ºëÊÅØÊôÇÈñìÔºàÂàÜÈêòÔºâ</label>
          <input id="breakInput" type="number" min="1" max="60" step="1" />
        </div>
      </div>
      <div class="d-foot">
        <button class="btn" value="cancel">ÂèñÊ∂à</button>
        <button class="btn primary" id="saveSettingsBtn" value="default">ÂÑ≤Â≠ò</button>
      </div>
    </form>
  </dialog>

  <script>
    // ---- State ----
    const ring = document.getElementById('ring');
    const timeEl = document.getElementById('time');
    const modeLabel = document.getElementById('modeLabel');
    const startPauseBtn = document.getElementById('startPauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const toggleBtn = document.getElementById('toggleBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const workTab = document.getElementById('workTab');
    const breakTab = document.getElementById('breakTab');
    const statusBadge = document.getElementById('statusBadge');
    const pomodoroCountEl = document.getElementById('pomodoroCount');

    const dialogEl = document.getElementById('settingsDialog');
    const workInput = document.getElementById('workInput');
    const breakInput = document.getElementById('breakInput');

    const CIRC = 2 * Math.PI * 54; // 339.292
    ring.style.strokeDasharray = CIRC.toFixed(3);

    const storage = {
      load() {
        try { return JSON.parse(localStorage.getItem('pomo:v1')) || {}; } catch { return {}; }
      },
      save(data) { localStorage.setItem('pomo:v1', JSON.stringify(data)); }
    };

    let persisted = storage.load();

    let workMinutes = Number.isFinite(persisted.workMinutes) ? persisted.workMinutes : 25;
    let breakMinutes = Number.isFinite(persisted.breakMinutes) ? persisted.breakMinutes : 5;
    let mode = (persisted.mode === 'break') ? 'break' : 'work';
    let remaining = ((persisted.remainingSec ?? (mode === 'work' ? workMinutes*60 : breakMinutes*60)));
    let running = false;
    let timer = null;
    let pomodoros = Number.isFinite(persisted.pomodoros) ? persisted.pomodoros : 0;

    // ---- Helpers ----
    function fmt(sec) {
      const m = Math.floor(sec / 60).toString().padStart(2, '0');
      const s = Math.floor(sec % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function applyTheme() {
      const root = document.documentElement;
      const isWork = mode === 'work';
      ring.setAttribute('stroke', getComputedStyle(root).getPropertyValue(isWork ? '--work' : '--break'));
      document.body.style.backgroundImage = `radial-gradient(1200px 800px at 70% -10%, ${isWork ? '#2b1a12' : '#112436'} 0%, transparent 60%),
                  radial-gradient(900px 700px at -10% 110%, ${isWork ? '#24161a' : '#101a2d'} 0%, transparent 60%),
                  linear-gradient(160deg, var(--bg-start), var(--bg-end))`;
      modeLabel.textContent = isWork ? 'Â∑•‰Ωú‰∏≠' : '‰ºëÊÅØ‰∏≠';
      workTab.classList.toggle('active', isWork);
      breakTab.classList.toggle('active', !isWork);
    }

    function setTitle() {
      document.title = `${fmt(remaining)} ‚Ä¢ Áï™ËåÑÈêò`;
    }

    function updateUI() {
      timeEl.textContent = fmt(remaining);
      setTitle();
      const total = (mode === 'work' ? workMinutes * 60 : breakMinutes * 60);
      const progress = Math.max(0, Math.min(1, 1 - remaining / total));
      ring.style.strokeDashoffset = (progress * CIRC).toFixed(3);
      pomodoroCountEl.textContent = pomodoros;
    }

    function persist() {
      storage.save({ workMinutes, breakMinutes, mode, remainingSec: remaining, pomodoros });
    }

    function start() {
      if (running) return;
      running = true;
      startPauseBtn.textContent = 'Êö´ÂÅú';
      startPauseBtn.setAttribute('aria-pressed', 'true');
      statusBadge.textContent = 'Ë®àÊôÇ‰∏≠‚Ä¶';
      timer = setInterval(tick, 1000);
    }

    function pause() {
      if (!running) return;
      running = false;
      startPauseBtn.textContent = 'ÈñãÂßã';
      startPauseBtn.setAttribute('aria-pressed', 'false');
      statusBadge.textContent = 'Â∑≤Êö´ÂÅú';
      clearInterval(timer); timer = null;
      persist();
    }

    function reset() {
      remaining = (mode === 'work' ? workMinutes * 60 : breakMinutes * 60);
      updateUI();
      statusBadge.textContent = 'Â∑≤ÈáçÁΩÆ';
      persist();
    }

    function switchMode(nextMode) {
      mode = nextMode || (mode === 'work' ? 'break' : 'work');
      applyTheme();
      remaining = (mode === 'work' ? workMinutes * 60 : breakMinutes * 60);
      updateUI();
      statusBadge.textContent = mode === 'work' ? 'ÂàáÊèõËá≥Â∑•‰Ωú' : 'ÂàáÊèõËá≥‰ºëÊÅØ';
      persist();
    }

    function completeCycle() {
      // Auto-switch & count only after a WORK session finishes
      if (mode === 'work') { pomodoros += 1; }
      switchMode();
      // Auto-continue into next session
      start();
    }

    function tick() {
      remaining -= 1;
      if (remaining <= 0) {
        remaining = 0; updateUI();
        pause();
        statusBadge.textContent = 'ÊôÇÈñìÂà∞ÔºÅ';
        // Small chime (optional, non-blocking)
        try { new AudioContext(); } catch {}
        completeCycle();
        return;
      }
      updateUI();
    }

    // ---- Event Wiring ----
    startPauseBtn.addEventListener('click', () => running ? pause() : start());
    resetBtn.addEventListener('click', () => { pause(); reset(); });
    toggleBtn.addEventListener('click', () => { pause(); switchMode(); });
    settingsBtn.addEventListener('click', () => {
      workInput.value = workMinutes;
      breakInput.value = breakMinutes;
      dialogEl.showModal();
    });

    document.getElementById('saveSettingsBtn').addEventListener('click', () => {
      const w = Math.max(1, Math.min(180, parseInt(workInput.value || '25', 10)));
      const b = Math.max(1, Math.min(60, parseInt(breakInput.value || '5', 10)));
      workMinutes = w; breakMinutes = b;
      // Reset current mode to apply new durations
      remaining = (mode === 'work' ? workMinutes * 60 : breakMinutes * 60);
      updateUI();
      persist();
    });

    // Tabs also switch mode
    workTab.addEventListener('click', () => { pause(); switchMode('work'); });
    breakTab.addEventListener('click', () => { pause(); switchMode('break'); });

    // Keyboard shortcuts: space=start/pause, r=reset, m=toggle mode, s=settings
    window.addEventListener('keydown', (e) => {
      if (['INPUT', 'TEXTAREA'].includes((e.target.tagName))) return;
      if (e.code === 'Space') { e.preventDefault(); running ? pause() : start(); }
      if (e.key.toLowerCase() === 'r') { pause(); reset(); }
      if (e.key.toLowerCase() === 'm') { pause(); switchMode(); }
      if (e.key.toLowerCase() === 's') { if (!dialogEl.open) { settingsBtn.click(); } }
    });

    // ---- Init ----
    applyTheme();
    updateUI();
  </script>
</body>
</html>