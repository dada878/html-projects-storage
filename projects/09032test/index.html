<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Flip Pomodoro Clock — White Theme</title>
<style>
  :root{
    /* 白色主題 */
    --page-bg:#ffffff;
    --panel:#ffffff;
    --text:#111111;
    --muted:#6b7280;
    --digit-bg:#ffffff;
    --digit-edge:#e5e7eb;
    --shadow: 0 12px 28px rgba(0,0,0,.12), 0 2px 6px rgba(0,0,0,.06);
    --radius:18px;
    --gap:10px;
    --flip-duration:.6s;
    --clock-size: clamp(260px, 55vw, 560px);
  }

  html,body{height:100%}
  body{
    margin:0; background: var(--page-bg); color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
    display:grid; place-items:center; padding:24px;
  }
  .app{width:min(100%,980px)}

  .header{display:flex; flex-wrap:wrap; gap:12px; align-items:end; justify-content:space-between; margin-bottom:16px}
  .header .stack{display:flex; gap:12px; flex-wrap:wrap; align-items:end}

  .field{
    background:var(--panel); padding:12px 14px; border-radius:14px;
    border:1px solid var(--digit-edge); display:grid; gap:6px; min-width:180px;
  }
  .field label{font-size:12px; color:var(--muted)}
  .field input{
    background:#fff; border:1px solid var(--digit-edge); color:var(--text);
    padding:10px 12px; border-radius:10px; font-size:14px; width:100%;
  }

  .buttons{display:flex; gap:10px; flex-wrap:wrap}
  .btn{
    appearance:none; border:1px solid var(--digit-edge); background:#fff; color:var(--text);
    padding:12px 16px; border-radius:12px; font-weight:600; cursor:pointer;
    box-shadow:0 1px 2px rgba(0,0,0,.06);
    transition:transform .08s ease, box-shadow .2s ease, background .2s ease;
  }
  .btn:hover{transform:translateY(-1px); box-shadow:0 4px 14px rgba(0,0,0,.08)}
  .btn:active{transform:translateY(0)}
  .btn.start.running{outline:2px solid #16a34a33}
  .btn.reset{background:#f8fafc}

  .phase{ margin:6px 2px 0; color:var(--muted); font-size:14px}
  .phase .work{color:#16a34a; font-weight:700}
  .phase .break{color:#ea580c; font-weight:700}

  /* CLOCK */
  .clock{
    width:var(--clock-size); margin:18px auto 0; display:flex; justify-content:center; gap:clamp(8px,2vw,16px);
  }
  .group{display:flex; gap:clamp(6px,1.5vw,12px); align-items:center}
  .colon{
    font-size:clamp(28px,8vw,54px); line-height:1; transform:translateY(-6%);
    color:#111; opacity:.6; user-select:none;
  }

  .digit{
    position:relative; width:clamp(56px,14vw,112px); height:clamp(76px,18vw,150px);
    perspective:1000px;
  }
  /* base card that always shows the current value (top & bottom halves) */
  .card{
    position:absolute; inset:0; border-radius:var(--radius);
    background: var(--digit-bg);
    color:#111; display:grid; place-items:center; font-weight:800;
    font-variant-numeric: tabular-nums; letter-spacing:1px;
    border:1px solid var(--digit-edge); box-shadow: var(--shadow);
    overflow:hidden;
  }
  .card .value{font-size:clamp(36px,9vw,86px)}
  .card .top, .card .bottom{
    position:absolute; left:0; right:0; height:50%; overflow:hidden; display:grid; place-items:center; background:var(--digit-bg)
  }
  .card .top{top:0; border-bottom:1px solid var(--digit-edge)}
  .card .bottom{bottom:0}

  /* flipping layers (overlay) */
  .flip-upper, .flip-lower{
    position:absolute; left:0; right:0; height:50%; overflow:hidden;
    backface-visibility:hidden; background:var(--digit-bg); color:#111;
    border:1px solid var(--digit-edge);
  }
  .flip-upper{ top:0; border-radius:var(--radius) var(--radius) 0 0; transform-origin:center bottom; }
  .flip-lower{ top:50%; border-radius:0 0 var(--radius) var(--radius); transform-origin:center top; }

  .flip-upper .txt, .flip-lower .txt{font-size:clamp(36px,9vw,86px); font-weight:800}

  @keyframes flipDown { from { transform: rotateX(0deg) } to { transform: rotateX(-90deg) } }
  @keyframes flipUp   { from { transform: rotateX(90deg)} to { transform: rotateX(0deg)   } }

  .animate-upper{ animation: flipDown var(--flip-duration) ease-in forwards }
  .animate-lower{ animation: flipUp   var(--flip-duration) ease-out forwards }

  .status{ margin:16px auto 0; max-width:var(--clock-size); color:var(--muted); font-size:14px}
  .sr-only{ position:absolute!important; width:1px;height:1px; padding:0;margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }

  @media (max-width:480px){
    .field{min-width:unset; flex:1}
    .header{gap:8px}
  }
</style>
</head>
<body>
  <main class="app" role="application" aria-label="翻頁蕃茄鐘（白色主題）">
    <div class="header">
      <div class="stack">
        <div class="field">
          <label for="workMins">工作時間（分鐘，預設 25）</label>
          <input id="workMins" type="number" inputmode="numeric" min="1" max="240" step="1" placeholder="25" aria-describedby="workHelp">
          <small id="workHelp" class="phase">完成後自動進入休息</small>
        </div>
        <div class="field">
          <label for="breakMins">休息時間（分鐘，預設 5）</label>
          <input id="breakMins" type="number" inputmode="numeric" min="1" max="120" step="1" placeholder="5" aria-describedby="breakHelp">
          <small id="breakHelp" class="phase">可自行調整</small>
        </div>
      </div>
      <div class="buttons">
        <button id="startBtn" class="btn start" aria-pressed="false">開始</button>
        <button id="pauseBtn" class="btn">暫停</button>
        <button id="resetBtn" class="btn reset" aria-label="重置為 00:00">重置</button>
      </div>
    </div>

    <div class="phase" aria-live="polite">
      模式：<span id="phaseText" class="work">工作</span>
    </div>

    <!-- Flip Clock -->
    <section class="clock" aria-live="off" aria-label="倒數計時：分秒">
      <div class="group" aria-label="分鐘">
        <div class="digit" data-slot="m10" aria-hidden="true"></div>
        <div class="digit" data-slot="m1"  aria-hidden="true"></div>
      </div>
      <div class="colon" aria-hidden="true">:</div>
      <div class="group" aria-label="秒鐘">
        <div class="digit" data-slot="s10" aria-hidden="true"></div>
        <div class="digit" data-slot="s1"  aria-hidden="true"></div>
      </div>
    </section>

    <p id="srLive" class="sr-only" aria-live="polite"></p>
    <div class="status" id="statusTips">⌛ 編輯分鐘後按「開始」套用。重置會停止計時並顯示 <b>00:00</b>。</div>
  </main>

<script>
(function(){
  // --- Utilities ---
  const clampInt = (v,min,max, fallback)=> {
    const n = parseInt(v,10);
    if (isNaN(n)) return fallback;
    return Math.min(Math.max(n,min),max);
  };
  const pad2 = n => String(n).padStart(2,'0');

  // --- Elements ---
  const workInput  = document.getElementById('workMins');
  const breakInput = document.getElementById('breakMins');
  const startBtn   = document.getElementById('startBtn');
  const pauseBtn   = document.getElementById('pauseBtn');
  const resetBtn   = document.getElementById('resetBtn');
  const phaseText  = document.getElementById('phaseText');
  const live       = document.getElementById('srLive');

  const slots = {
    m10: document.querySelector('.digit[data-slot="m10"]'),
    m1:  document.querySelector('.digit[data-slot="m1"]'),
    s10: document.querySelector('.digit[data-slot="s10"]'),
    s1:  document.querySelector('.digit[data-slot="s1"]')
  };

  // --- State ---
  let phase = 'work'; // 'work' | 'break'
  let totalMs = 25*60*1000;
  let timer = null;
  let lastDigits = { m10:null, m1:null, s10:null, s1:null };
  let running = false;

  // Init
  function init(){
    buildAllDigits();
    setPhase('work', 25*60*1000, true);
    drawImmediate();
  }

  // Build base cards once to避免「兩半疊影」
  function buildAllDigits(){
    Object.values(slots).forEach(slot=>{
      if (slot._built) return;
      const base = document.createElement('div');
      base.className = 'card';
      base.innerHTML = `
        <div class="top"><div class="value">0</div></div>
        <div class="bottom"><div class="value">0</div></div>
      `;
      slot.appendChild(base);
      slot._built = true;
    });
  }

  function setPhase(next, ms, announce){
    phase = next;
    totalMs = ms;
    phaseText.textContent = phase === 'work' ? '工作' : '休息';
    phaseText.className = phase === 'work' ? 'work' : 'break';
    if (announce) speak();
  }

  function speak(){
    const {min,sec} = getMinSec(totalMs);
    live.textContent = `${phase === 'work' ? '工作' : '休息'}，剩餘 ${min} 分 ${sec} 秒`;
  }

  function getDurationsFromInputs(){
    const w = clampInt(workInput.value, 1, 240, 25);
    const b = clampInt(breakInput.value,1, 120, 5);
    return {workMs: w*60*1000, breakMs: b*60*1000};
  }

  function start(){
    const {workMs, breakMs} = getDurationsFromInputs();
    const targetMs = (phase === 'work') ? workMs : breakMs;
    if (!running) {
      if (totalMs <= 0 || totalMs > targetMs) totalMs = targetMs;
    }
    running = true;
    startBtn.classList.add('running');
    startBtn.setAttribute('aria-pressed','true');

    if (timer) clearInterval(timer);
    let lastTick = performance.now();
    timer = setInterval(()=>{
      const now = performance.now();
      const dt = now - lastTick;
      lastTick = now;
      totalMs = Math.max(0, totalMs - dt);
      draw();
      if (totalMs <= 0){
        const {workMs, breakMs} = getDurationsFromInputs();
        if (phase === 'work') setPhase('break', breakMs, true);
        else setPhase('work', workMs, true);
        drawImmediate();
      }
    }, 80);
  }

  function pause(){
    running = false;
    startBtn.classList.remove('running');
    startBtn.setAttribute('aria-pressed','false');
    if (timer){ clearInterval(timer); timer = null; }
    speak();
  }

  function reset(){
    pause();
    totalMs = 0;
    drawImmediate(); // show 00:00
  }

  function getMinSec(ms){
    const totalSec = Math.ceil(ms/1000);
    const min = Math.floor(totalSec/60);
    const sec = totalSec%60;
    return {min,sec};
  }

  function toDigits(min, sec){
    const m = pad2(min);
    const s = pad2(sec);
    return { m10:m[0], m1:m[1], s10:s[0], s1:s[1] };
  }

  function drawImmediate(){
    const {min,sec} = getMinSec(totalMs);
    const digits = toDigits(min, sec);
    for (const k of Object.keys(slots)){
      renderDigit(slots[k], digits[k], true);
      lastDigits[k] = digits[k];
    }
    speak();
  }

  function draw(){
    const {min,sec} = getMinSec(totalMs);
    const digits = toDigits(min, sec);
    for (const k of Object.keys(slots)){
      if (lastDigits[k] !== digits[k]){
        renderDigit(slots[k], digits[k], false);
        lastDigits[k] = digits[k];
      }
    }
  }

  // Render one digit with flip
  function renderDigit(slot, newVal, immediate=false){
    const top = slot.querySelector('.top .value');
    const bottom = slot.querySelector('.bottom .value');

    if (immediate){
      top.textContent = newVal;
      bottom.textContent = newVal;
      // 清掉可能殘留的動畫層
      slot.querySelectorAll('.flip-upper, .flip-lower').forEach(n=>n.remove());
      return;
    }

    // 建立翻頁層（上半翻下、下半翻上）
    const upper = document.createElement('div');
    upper.className = 'flip-upper animate-upper';
    upper.innerHTML = `<div class="txt">${top.textContent}</div>`;

    const lower = document.createElement('div');
    lower.className = 'flip-lower animate-lower';
    lower.innerHTML = `<div class="txt">${newVal}</div>`;

    upper.addEventListener('animationend', ()=> { top.textContent = newVal; }, {once:true});
    lower.addEventListener('animationend', ()=> {
      bottom.textContent = newVal;
      upper.remove(); lower.remove();
    }, {once:true});

    slot.appendChild(upper);
    slot.appendChild(lower);
  }

  // Events
  startBtn.addEventListener('click', start);
  pauseBtn.addEventListener('click', pause);
  resetBtn.addEventListener('click', reset);

  // 即時更新（未運行狀態）
  workInput.addEventListener('change', ()=>{
    const v = clampInt(workInput.value,1,240,25);
    if (phase==='work' && !running){ totalMs = v*60*1000; drawImmediate(); }
  });
  breakInput.addEventListener('change', ()=>{
    const v = clampInt(breakInput.value,1,120,5);
    if (phase==='break' && !running){ totalMs = v*60*1000; drawImmediate(); }
  });

  // keyboard a11y
  [startBtn, pauseBtn, resetBtn].forEach(btn=>{
    btn.addEventListener('keydown', e=>{
      if (e.key==='Enter' || e.key===' ') { e.preventDefault(); btn.click(); }
    });
  });

  init();
})();
</script>
</body>
</html>
